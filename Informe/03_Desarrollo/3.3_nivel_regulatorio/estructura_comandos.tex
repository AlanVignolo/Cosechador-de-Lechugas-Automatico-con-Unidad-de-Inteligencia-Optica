El protocolo de comunicación entre el nivel regulatorio y el supervisor utiliza mensajes ASCII delimitados con formato estructurado. Cada comando sigue la estructura \texttt{<COMANDO:param1,param2>\textbackslash n}, donde los elementos son delimitadores \texttt{<} y \texttt{>}, identificador de comando (1-3 caracteres ASCII), separador de dos puntos (opcional), parámetros separados por comas, y terminador de línea.

La Tabla \ref{tab:comandos_uart} presenta el conjunto completo de comandos implementados.

\begin{table}[H]
\centering
\small
\begin{tabular}{|l|l|p{4.5cm}|l|}
\hline
\textbf{Comando} & \textbf{Parámetros} & \textbf{Descripción} & \textbf{Ejemplo} \\
\hline
\multicolumn{4}{|c|}{\textbf{Control de movimiento}} \\
\hline
M & x, y (mm) & Movimiento relativo en plano XY & \texttt{<M:50.5,-20>} \\
\hline
V & h, v (pasos/s) & Configurar velocidades máximas & \texttt{<V:10000,15000>} \\
\hline
H & - & Ejecutar secuencia de homing & \texttt{<H>} \\
\hline
XY? & - & Consultar posición actual & \texttt{<XY?>} \\
\hline
\multicolumn{4}{|c|}{\textbf{Control de brazo y gripper}} \\
\hline
A & s1, s2, t (°, °, ms) & Mover ambos servos con tiempo & \texttt{<A:90,45,2000>} \\
\hline
P & num, angle (-, °) & Mover servo individual (1 o 2) & \texttt{<P:1,120>} \\
\hline
G & O/C & Abrir (O) o Cerrar (C) gripper & \texttt{<G:O>} \\
\hline
Q & - & Consultar ángulos de servos & \texttt{<Q>} \\
\hline
\multicolumn{4}{|c|}{\textbf{Sistema y monitoreo}} \\
\hline
S? & - & Estado completo del sistema & \texttt{<S?>} \\
\hline
L? & - & Estado de finales de carrera & \texttt{<L?>} \\
\hline
S & - & Emergency stop (inmediato) & \texttt{<S>} \\
\hline
HB & 1 & Señal de sincronización periódica & \texttt{<HB:1>} \\
\hline
\end{tabular}
\caption{Comandos UART del nivel regulatorio}
\label{tab:comandos_uart}
\end{table}

El firmware genera dos tipos de respuestas: comandos exitosos retornan mensajes con prefijo \texttt{RESPONSE} seguido de los datos solicitados, mientras que comandos fallidos retornan mensajes con prefijo \texttt{ERROR} seguido del código de error. Además, el firmware envía notificaciones automáticas cuando ocurren eventos importantes (Tabla \ref{tab:eventos_asincronos}), como finalización de movimientos, activación de límites, o cambios de estado del gripper.

\begin{table}[H]
\centering
\begin{tabular}{|l|p{8cm}|}
\hline
\textbf{Evento} & \textbf{Descripción} \\
\hline
\texttt{<STEPPER\_MOVE\_COMPLETED:x,y>} & Movimiento completado. Posición final en mm. \\
\hline
\texttt{<LIMIT\_TRIGGERED:tipo>} & Final de carrera activado por interrupción. \\
\hline
\texttt{<GRIPPER\_OPENED>} & Gripper completó apertura. \\
\hline
\texttt{<GRIPPER\_CLOSED>} & Gripper completó cierre. \\
\hline
\texttt{<STEPPER\_EMERGENCY\_STOP>} & Parada de emergencia ejecutada. \\
\hline
\end{tabular}
\caption{Eventos asíncronos del firmware}
\label{tab:eventos_asincronos}
\end{table}

El firmware utiliza un analizador sintáctico basado en máquina de estados que almacena bytes en buffer circular de 256 bytes. Cuando detecta los delimitadores, analiza y ejecuta el comando, enviando la respuesta inmediatamente.
